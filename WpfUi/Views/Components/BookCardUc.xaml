<UserControl x:Class="WpfUi.Components.BookCardUc"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:custom="clr-namespace:HighlightTextBlockControl;assembly=HighlightTextBlockControl"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:WpfUi.Components"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:xb="clr-namespace:Microsoft.Xaml.Behaviors;assembly=Microsoft.Xaml.Behaviors"
             Name="parent"
             d:DesignHeight="450"
             d:DesignWidth="800"
             mc:Ignorable="d">
    <UserControl.Resources>
        <Style x:Key="BookNameTextStyle" TargetType="custom:HighlightTextBlock">
            <Setter Property="TextWrapping" Value="Wrap" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="Margin" Value="5 10" />
            <Setter Property="HorizontalAlignment" Value="Left" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>
        <Style x:Key="DateTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="10" />
            <Setter Property="Margin" Value="3" />
            <Setter Property="HorizontalAlignment" Value="Right" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>
        <Style x:Key="CheckBoxStyle" TargetType="CheckBox">
            <Setter Property="FontSize" Value="10" />
            <Setter Property="Margin" Value="3" />
            <Setter Property="HorizontalAlignment" Value="Right" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>
        <Style x:Key="TagStyle" TargetType="custom:HighlightTextBlock">
            <Setter Property="FontSize" Value="10" />
            <Setter Property="Margin" Value="5" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Foreground" Value="Lavender" />
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="VerticalAlignment" Value="Center" />

        </Style>
        <Style x:Key="HighlightStyle" TargetType="Run">
            <Setter Property="Foreground" Value="Black" />
            <Setter Property="Background" Value="Yellow" />

        </Style>
        <Style x:Key="TagHighlightStyle" TargetType="Run">
            <Setter Property="Foreground" Value="Black" />
            <Setter Property="Background" Value="Yellow" />
            <Setter Property="FontWeight" Value="Normal" />

        </Style>

        <BooleanToVisibilityConverter x:Key="boolToVisibilityConverter" />
    </UserControl.Resources>
    <Border Margin="5"
            Padding="10"
            BorderBrush="Gainsboro"
            BorderThickness="1"
            CornerRadius="5"
            DataContext="{Binding ElementName=parent}">

        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="auto" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="auto" />
            </Grid.RowDefinitions>

            <custom:HighlightTextBlock x:Name="BookNameHighlightTextBlock"
                                       Grid.Row="0"
                                       Grid.Column="0"
                                       HighlightRunStyle="{StaticResource HighlightStyle}"
                                       HighlightText="{Binding HighlightText, Mode=TwoWay}"
                                       Style="{StaticResource BookNameTextStyle}"
                                       Text="{Binding BookName}" />

            <CheckBox Grid.Row="0"
                      Grid.Column="1"
                      Content="Is Read"
                      IsChecked="{Binding IsRead, Mode=TwoWay}"
                      Style="{StaticResource CheckBoxStyle}">
                <xb:Interaction.Triggers>
                    <xb:EventTrigger EventName="Checked">
                        <xb:InvokeCommandAction Command="{Binding IsReadChangedCommand}" />
                    </xb:EventTrigger>
                    <xb:EventTrigger EventName="Unchecked">
                        <xb:InvokeCommandAction Command="{Binding IsReadChangedCommand}" />
                    </xb:EventTrigger>
                </xb:Interaction.Triggers>
            </CheckBox>
            <TextBlock Grid.Row="1"
                       Grid.Column="1"
                       Style="{StaticResource DateTextStyle}"
                       Text="{Binding DateRead, StringFormat=d}"
                       Visibility="{Binding IsRead, Converter={StaticResource boolToVisibilityConverter}}" />



            <ItemsControl Grid.Row="1"
                          Grid.Column="0"
                          ItemsSource="{Binding Path=Tags}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="3"
                                Background="MediumSlateBlue"
                                CornerRadius="3">
                            <custom:HighlightTextBlock HighlightRunStyle="{StaticResource TagHighlightStyle}"
                                                       HighlightText="{Binding ElementName=BookNameHighlightTextBlock, Path=HighlightText}"
                                                       Style="{StaticResource TagStyle}"
                                                       Text="{Binding}" />
                        </Border>

                    </DataTemplate>
                </ItemsControl.ItemTemplate>
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel HorizontalAlignment="Left"
                                   VerticalAlignment="Center"
                                   IsItemsHost="True"
                                   Orientation="Horizontal" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
            </ItemsControl>


        </Grid>
    </Border>
</UserControl>
